function onError(a){console.log("[DB error]: "+a)}window.indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB,"webkitIndexedDB"in window&&(window.IDBTransaction=window.webkitIDBTransaction,window.IDBKeyRange=window.webkitIDBKeyRange);var DB={db:null,log:function(){var a=Array.prototype.slice.apply(arguments);return a.unshift("[DB]: "),console.log.apply(window,a)},init:function(){return new Promise(function(a,b){var c=1,d=indexedDB.open("AwesomeScreenshot",c);d.onupgradeneeded=function(a){console.log("onupgradeneeded",a);var b=a.target.result;a.target.transaction.onerror=onError,b.objectStoreNames.contains("recordings")&&b.deleteObjectStore("recordings");var c=b.createObjectStore("recordings",{autoIncrement:!0});c.createIndex("by_id","id",{unique:!0})},d.onsuccess=function(b){DB.db=b.target.result,a(b.target.result)},d.onerror=function(a){onError(a),b(a)}})},save:function(a){var b=this.db;return new Promise(function(c,d){var e=b.transaction(["recordings"],"readwrite"),f=e.objectStore("recordings"),g=(new Date).getTime(),h=f.put({id:g,fileUrl:a.fileUrl,detail:{title:a.title,youtubeUrl:"",gDriveUrl:"",size:a.size,duration:a.duration,timeStamp:g,thumbnailUrl:""}});h.onsuccess=function(){c(g)},h.onerror=d})},get:function(a){var b=this.db;return new Promise(function(c,d){var e=b.transaction(["recordings"],"readwrite"),f=e.objectStore("recordings"),g=f.index("by_id").get(a);g.onsuccess=function(a){var b=a.target.result;c(b)},g.onerror=d})},getAll:function(){var a=this.db;return new Promise(function(b,c){var d=a.transaction(["recordings"],"readwrite"),e=d.objectStore("recordings"),f=e.getAll();f.onsuccess=function(a){var c=a.target.result;b(c)},f.onerror=c})},_getCursor:function(a){var b=this.db;return new Promise(function(c,d){var e=b.transaction(["recordings"],"readwrite"),f=e.objectStore("recordings"),g=IDBKeyRange.only(a),h=f.index("by_id").openCursor(g);h.onsuccess=function(a){var b=a.target.result;b&&c(b)},h.onerror=d})},updateYoutubeUrl:function(a,b){var c=this;return new Promise(function(d,e){c._getCursor(a).then(function(a){a.value.detail.youtubeUrl=b;var c=a.update(a.value);c.onsuccess=d,c.onerror=e})})},update:function(a,b){var c=this.db;return new Promise(function(d,e){var f=c.transaction(["recordings"],"readwrite"),g=f.objectStore("recordings"),h=IDBKeyRange.only(a),i=g.index("by_id").openCursor(h);i.onsuccess=function(a){var c=a.target.result;if(c){var e=c.update(b);e.onsuccess=function(){d()}}},i.onerror=e})},deleteAll:function(){var a=this.db;return new Promise(function(b,c){var d=a.transaction(["recordings"],"readwrite"),e=d.objectStore("recordings"),f=e.clear();f.onsuccess=function(a){var c=a.target.result;b(c)},f.onerror=c})},"delete":function(a){var b=this.db;return new Promise(function(c,d){var e=b.transaction(["recordings"],"readwrite"),f=e.objectStore("recordings"),g=IDBKeyRange.only(a),h=f.index("by_id").openCursor(g);h.onsuccess=function(a){var b=a.target.result;if(b){var d=b.delete();d.onsuccess=function(){c()}}},h.onerror=d})}};