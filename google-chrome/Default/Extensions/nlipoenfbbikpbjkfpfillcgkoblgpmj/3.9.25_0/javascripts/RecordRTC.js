"use strict";function RecordRTC(a,b){function c(){return b.disableLogs||console.debug("started recording "+b.type+" stream."),k?(k.clearRecordedData(),k.record(),l.recordingDuration&&j(),l):(d(function(){l.recordingDuration&&j()}),l)}function d(c){c&&(b.initCallback=function(){c(),c=b.initCallback=null});var d=new GetRecorderType(a,b);k=new d(a,b),k.record(),b.disableLogs||console.debug("Initialized recorderType:",k.constructor.name,"for output-type:",b.type)}function e(a){function c(c){for(var e in k)l&&(l[e]=k[e]),d&&(d[e]=k[e]);var f=k.blob;if(!f){if(!c)throw"Recording failed.";k.blob=f=c}if(a){var g=URL.createObjectURL(f);a(g)}f&&!b.disableLogs&&console.debug(f.type,"->",bytesToSize(f.size)),b.autoWriteToDisk&&i(function(a){var c={};c[b.type+"Blob"]=a,DiskStorage.Store(c)})}if(!k)return console.warn(m);var d=this;b.disableLogs||console.warn("Stopped recording "+b.type+" stream."),"gif"!==b.type?k.stop(c):(k.stop(),c())}function f(){return k?(k.pause(),void(b.disableLogs||console.debug("Paused recording."))):console.warn(m)}function g(){return k?(k.resume(),void(b.disableLogs||console.debug("Resumed recording."))):console.warn(m)}function h(a){postMessage((new FileReaderSync).readAsDataURL(a))}function i(a,c){function d(a){var b=URL.createObjectURL(new Blob([a.toString(),"this.onmessage =  function (e) {"+a.name+"(e.data);}"],{type:"application/javascript"})),c=new Worker(b);return URL.revokeObjectURL(b),c}if(!a)throw"Pass a callback function over getDataURL.";var e=c?c.blob:(k||{}).blob;if(!e)return b.disableLogs||console.warn("Blob encoder did not finish its job yet."),void setTimeout(function(){i(a,c)},1e3);if("undefined"==typeof Worker||navigator.mozGetUserMedia){var f=new FileReader;f.readAsDataURL(e),f.onload=function(b){a(b.target.result)}}else{var g=d(h);g.onmessage=function(b){a(b.data)},g.postMessage(e)}}function j(){setTimeout(function(){e(l.onRecordingStopped)},l.recordingDuration)}if(!a)throw"MediaStream is mandatory.";b=b||{type:"video"},b=new RecordRTCConfiguration(a,b);var k,l=this,m='It seems that "startRecording" is not invoked for '+b.type+" recorder.",n={startRecording:c,stopRecording:e,pauseRecording:f,resumeRecording:g,initRecorder:d,setRecordingDuration:function(a,b){if("undefined"==typeof a)throw"milliseconds is required.";if("number"!=typeof a)throw"milliseconds must be a number.";return l.recordingDuration=a,l.onRecordingStopped=b||function(){},{onRecordingStopped:function(a){l.onRecordingStopped=a}}},clearRecordedData:function(){return k?(k.clearRecordedData(),void(b.disableLogs||console.debug("Cleared old recorded data."))):console.warn(m)},getBlob:function(){return k?k.blob:console.warn(m)},getDataURL:i,toURL:function(){return k?URL.createObjectURL(k.blob):console.warn(m)},save:function(a){return k?void invokeSaveAsDialog(k.blob,a):console.warn(m)},getFromDisk:function(a){return k?void RecordRTC.getFromDisk(b.type,a):console.warn(m)},setAdvertisementArray:function(a){b.advertisement=[];for(var c=a.length,d=0;c>d;d++)b.advertisement.push({duration:d,image:a[d]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,view:null};if(!this)return l=n,n;for(var o in n)this[o]=n[o];return l=this,n}function RecordRTCConfiguration(a,b){return b.recorderType&&!b.type&&(b.recorderType===WhammyRecorder||b.recorderType===CanvasRecorder?b.type="video":b.recorderType===GifRecorder?b.type="gif":b.recorderType===StereoAudioRecorder?b.type="audio":b.recorderType===MediaStreamRecorder&&(a.getAudioTracks().length&&a.getVideoTracks().length?b.type="video":a.getAudioTracks().length&&!a.getVideoTracks().length?b.type="audio":!a.getAudioTracks().length&&a.getVideoTracks().length&&(b.type="audio"))),"undefined"!=typeof MediaStreamRecorder&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(b.mimeType||(b.mimeType="video/webm"),b.type||(b.type=b.mimeType.split("/")[0]),!b.bitsPerSecond),b.type||(b.mimeType&&(b.type=b.mimeType.split("/")[0]),b.type||(b.type="audio")),b}function GetRecorderType(a,b){var c;return(isChrome||isEdge||isOpera)&&(c=StereoAudioRecorder),"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&!isChrome&&(c=MediaStreamRecorder),"video"===b.type&&(isChrome||isOpera)&&(c=WhammyRecorder),"gif"===b.type&&(c=GifRecorder),"canvas"===b.type&&(c=CanvasRecorder),isMediaRecorderCompatible()&&c!==CanvasRecorder&&c!==GifRecorder&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(a.getVideoTracks().length||a.getAudioTracks().length)&&("audio"===b.type?"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm")&&(c=MediaStreamRecorder):"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("video/webm")&&(c=MediaStreamRecorder)),b.recorderType&&(c=b.recorderType),!b.disableLogs&&c&&c.name&&console.debug("Using recorderType:",c.name||c.constructor.name),c}function MRecordRTC(a){this.addStream=function(b){b&&(a=b)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var b,c=this.mediaType,d=this.mimeType||{audio:null,video:null,gif:null};if("function"!=typeof c.audio&&isMediaRecorderCompatible()&&a.getAudioTracks&&!a.getAudioTracks().length&&(c.audio=!1),"function"!=typeof c.video&&isMediaRecorderCompatible()&&a.getVideoTracks&&!a.getVideoTracks().length&&(c.video=!1),!c.audio&&!c.video)throw"MediaStream must have either audio or video tracks.";if(c.audio&&(b=null,"function"==typeof c.audio&&(b=c.audio),this.audioRecorder=new RecordRTC(a,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:b,mimeType:d.audio}),c.video||this.audioRecorder.startRecording()),c.video){b=null,"function"==typeof c.video&&(b=c.video);var e=a;if(isMediaRecorderCompatible()&&c.audio&&"function"==typeof c.audio){var f=a.getVideoTracks()[0];navigator.mozGetUserMedia?(e=new MediaStream,e.addTrack(f),b&&b===WhammyRecorder&&(b=MediaStreamRecorder)):e=new MediaStream([f])}this.videoRecorder=new RecordRTC(e,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:b,mimeType:d.video}),c.audio||this.videoRecorder.startRecording()}if(c.audio&&c.video){var g=this;isMediaRecorderCompatible()?(g.audioRecorder=null,g.videoRecorder.startRecording()):g.videoRecorder.initRecorder(function(){g.audioRecorder.initRecorder(function(){g.videoRecorder.startRecording(),g.audioRecorder.startRecording()})})}c.gif&&(b=null,"function"==typeof c.gif&&(b=c.gif),this.gifRecorder=new RecordRTC(a,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:b,mimeType:d.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(a){a=a||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(b){a(b,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(b){a(b,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(b){a(b,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(a){var b={};return this.audioRecorder&&(b.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(b.video=this.videoRecorder.getBlob()),this.gifRecorder&&(b.gif=this.gifRecorder.getBlob()),a&&a(b),b},this.getDataURL=function(a){function b(a,b){if("undefined"!=typeof Worker){var d=c(function(a){postMessage((new FileReaderSync).readAsDataURL(a))});d.onmessage=function(a){b(a.data)},d.postMessage(a)}else{var e=new FileReader;e.readAsDataURL(a),e.onload=function(a){b(a.target.result)}}}function c(a){var b,c=URL.createObjectURL(new Blob([a.toString(),"this.onmessage =  function (e) {"+a.name+"(e.data);}"],{type:"application/javascript"})),d=new Worker(c);if("undefined"!=typeof URL)b=URL;else{if("undefined"==typeof webkitURL)throw"Neither URL nor webkitURL detected.";b=webkitURL}return b.revokeObjectURL(c),d}this.getBlob(function(c){c.audio&&c.video?b(c.audio,function(d){b(c.video,function(b){a({audio:d,video:b})})}):c.audio?b(c.audio,function(b){a({audio:b})}):c.video&&b(c.video,function(b){a({video:b})})})},this.writeToDisk=function(){RecordRTC.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(a){a=a||{audio:!0,video:!0,gif:!0},a.audio&&this.audioRecorder&&this.audioRecorder.save("string"==typeof a.audio?a.audio:""),a.video&&this.videoRecorder&&this.videoRecorder.save("string"==typeof a.video?a.video:""),a.gif&&this.gifRecorder&&this.gifRecorder.save("string"==typeof a.gif?a.gif:"")}}function bytesToSize(a){var b=1e3,c=["Bytes","KB","MB","GB","TB"];if(0===a)return"0 Bytes";var d=parseInt(Math.floor(Math.log(a)/Math.log(b)),10);return(a/Math.pow(b,d)).toPrecision(3)+" "+c[d]}function invokeSaveAsDialog(a,b){if(!a)throw"Blob object is required.";if(!a.type)try{a.type="video/webm"}catch(c){}var d=(a.type||"video/webm").split("/")[1];if(b&&-1!==b.indexOf(".")){var e=b.split(".");b=e[0],d=e[1]}var f=(b||Math.round(9999999999*Math.random())+888888888)+"."+d;if("undefined"!=typeof navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(a,f);if("undefined"!=typeof navigator.msSaveBlob)return navigator.msSaveBlob(a,f);var g=document.createElement("a");return g.href=URL.createObjectURL(a),console.log(g.href),g.href}function isMediaRecorderCompatible(){var a=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,b=!!window.chrome&&!a,c="undefined"!=typeof window.InstallTrigger;if(c)return!0;var d,e,f=(navigator.appVersion,navigator.userAgent),g=""+parseFloat(navigator.appVersion),h=parseInt(navigator.appVersion,10);return(b||a)&&(d=f.indexOf("Chrome"),g=f.substring(d+7)),-1!==(e=g.indexOf(";"))&&(g=g.substring(0,e)),-1!==(e=g.indexOf(" "))&&(g=g.substring(0,e)),h=parseInt(""+g,10),isNaN(h)&&(g=""+parseFloat(navigator.appVersion),h=parseInt(navigator.appVersion,10)),h>=49}function MediaStreamRecorder(a,b){function c(){if("active"in a){if(!a.active)return!1}else if("ended"in a&&a.ended)return!1;return!0}var d=this;if(b=b||{mimeType:"video/webm"},"audio"===b.type){if(a.getVideoTracks().length&&a.getAudioTracks().length){var e;navigator.mozGetUserMedia?(e=new MediaStream,e.addTrack(a.getAudioTracks()[0])):e=new MediaStream(a.getAudioTracks()),a=e}b.mimeType&&-1!==b.mimeType.toString().toLowerCase().indexOf("audio")||(b.mimeType=isChrome?"audio/webm":"audio/ogg"),b.mimeType&&"audio/ogg"!==b.mimeType.toString().toLowerCase()&&navigator.mozGetUserMedia&&(b.mimeType="audio/ogg")}this.record=function(){d.blob=null;var c=b;b.disableLogs||console.log("Passing following config over MediaRecorder API.",c),f&&(f=null),isChrome&&!isMediaRecorderCompatible()&&(c="video/vp8"),"function"==typeof MediaRecorder.isTypeSupported&&c.mimeType&&(MediaRecorder.isTypeSupported(c.mimeType)||(b.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",c.mimeType),c.mimeType="audio"===b.type?"audio/webm":"video/webm"));try{f=new MediaRecorder(a,c)}catch(e){f=new MediaRecorder(a)}!MediaRecorder.isTypeSupported&&"canRecordMimeType"in f&&f.canRecordMimeType(b.mimeType)===!1&&(b.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",b.mimeType)),f.ignoreMutedMedia=b.ignoreMutedMedia||!1,f.ondataavailable=function(a){d.dontFireOnDataAvailableEvent||!a.data||!a.data.size||a.data.size<100||d.blob||(console.log(a.data),d.blob=b.getNativeBlob?a.data:new Blob([a.data],{type:b.mimeType||"video/webm"}),d.recordingCallback&&(d.recordingCallback(d.blob),d.recordingCallback=null))},f.onerror=function(a){b.disableLogs||("InvalidState"===a.name?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed."):"OutOfMemory"===a.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute."):"IllegalStreamModification"===a.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute."):"OtherRecordingError"===a.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute."):"GenericError"===a.name?console.error("The UA cannot provide the codec or recording option that has been requested.",a):console.error("MediaRecorder Error",a)),"inactive"!==f.state&&"stopped"!==f.state&&f.stop()},f.start(36e6),b.onAudioProcessStarted&&b.onAudioProcessStarted(),b.initCallback&&b.initCallback()},this.stop=function(a){f&&(this.recordingCallback=function(b){f=null,a&&a(b)},"recording"===f.state&&f.stop())},this.pause=function(){f&&"recording"===f.state&&f.pause()},this.resume=function(){if(this.dontFireOnDataAvailableEvent){this.dontFireOnDataAvailableEvent=!1;var a=b.disableLogs;return b.disableLogs=!0,this.record(),void(b.disableLogs=a)}f&&"paused"===f.state&&f.resume()},this.clearRecordedData=function(){f&&(this.pause(),this.dontFireOnDataAvailableEvent=!0,this.stop())};var f,d=this;!function g(){return f?c()===!1?(b.disableLogs||console.log("MediaStream seems stopped."),void d.stop()):void setTimeout(g,1e3):void 0}()}function StereoAudioRecorder(a,b){function c(){if("active"in a){if(!a.active)return!1}else if("ended"in a&&a.ended)return!1;return!0}function d(a,b){function c(a,b){function c(a,b){for(var c=new Float64Array(b),d=0,e=a.length,f=0;e>f;f++){var g=a[f];c.set(g,d),d+=g.length}return c}function d(a,b){for(var c=a.length+b.length,d=new Float64Array(c),e=0,f=0;c>f;)d[f++]=a[e],d[f++]=b[e],e++;return d}function e(a,b,c){for(var d=c.length,e=0;d>e;e++)a.setUint8(b+e,c.charCodeAt(e))}var f=a.numberOfAudioChannels,g=a.leftBuffers.slice(0),h=a.rightBuffers.slice(0),i=a.sampleRate,j=a.internalInterleavedLength;2===f&&(g=c(g,j),h=c(h,j)),1===f&&(g=c(g,j));var k;2===f&&(k=d(g,h)),1===f&&(k=g);var l=k.length,m=44+2*l,n=new ArrayBuffer(m),o=new DataView(n);e(o,0,"RIFF"),o.setUint32(4,44+2*l,!0),e(o,8,"WAVE"),e(o,12,"fmt "),o.setUint32(16,16,!0),o.setUint16(20,1,!0),o.setUint16(22,f,!0),o.setUint32(24,i,!0),o.setUint32(28,2*i,!0),o.setUint16(32,2*f,!0),o.setUint16(34,16,!0),e(o,36,"data"),o.setUint32(40,2*l,!0);for(var p=l,q=44,r=1,s=0;p>s;s++)o.setInt16(q,32767*k[s]*r,!0),q+=2;return b?b({buffer:n,view:o}):void postMessage({buffer:n,view:o})}if(!isChrome)return void c(a,function(a){b(a.buffer,a.view)});var d=e(c);d.onmessage=function(a){b(a.data.buffer,a.data.view),URL.revokeObjectURL(d.workerURL)},d.postMessage(a)}function e(a){var b=URL.createObjectURL(new Blob([a.toString(),";this.onmessage =  function (e) {"+a.name+"(e.data);}"],{type:"application/javascript"})),c=new Worker(b);return c.workerURL=b,c}function f(a){if(!s){if(c()===!1&&(b.disableLogs||console.log("MediaStream seems stopped."),g.disconnect(),k=!1),!k)return void o.disconnect();t||(t=!0,b.onAudioProcessStarted&&b.onAudioProcessStarted(),b.initCallback&&b.initCallback());var d=a.inputBuffer.getChannelData(0);if(i.push(new Float32Array(d)),2===m){var e=a.inputBuffer.getChannelData(1);j.push(new Float32Array(e))}l+=q}}if(!a.getAudioTracks().length)throw"Your stream has no audio tracks.";b=b||{};var g,h=this,i=[],j=[],k=!1,l=0,m=2;b.leftChannel===!0&&(m=1),1===b.numberOfAudioChannels&&(m=1),b.disableLogs||console.debug("StereoAudioRecorder is set to record number of channels: ",m),this.record=function(){if(c()===!1)throw"Please make sure MediaStream is active.";i.length=j.length=0,l=0,o&&o.connect(g),t=s=!1,k=!0},this.stop=function(a){k=!1,d({sampleRate:r,numberOfAudioChannels:m,internalInterleavedLength:l,leftBuffers:i,rightBuffers:1===m?[]:j},function(b,c){h.blob=new Blob([c],{type:"audio/wav"}),h.buffer=new ArrayBuffer(c.buffer.byteLength),h.view=c,h.sampleRate=r,h.bufferSize=q,h.length=l,a&&a(),t=!1})},Storage.AudioContextConstructor||(Storage.AudioContextConstructor=new Storage.AudioContext);var n=Storage.AudioContextConstructor,o=n.createMediaStreamSource(a),p=[0,256,512,1024,2048,4096,8192,16384],q="undefined"==typeof b.bufferSize?4096:b.bufferSize;if(-1===p.indexOf(q)&&(b.disableLogs||console.warn("Legal values for buffer-size are "+JSON.stringify(p,null,"	"))),n.createJavaScriptNode)g=n.createJavaScriptNode(q,m,m);else{if(!n.createScriptProcessor)throw"WebAudio API has no support on this browser.";g=n.createScriptProcessor(q,m,m)}o.connect(g),b.bufferSize||(q=g.bufferSize);var r="undefined"!=typeof b.sampleRate?b.sampleRate:n.sampleRate||44100;(22050>r||r>96e3)&&(b.disableLogs||console.warn("sample-rate must be under range 22050 and 96000.")),b.disableLogs||(console.log("sample-rate",r),console.log("buffer-size",q));var s=!1;this.pause=function(){s=!0},this.resume=function(){if(c()===!1)throw"Please make sure MediaStream is active.";return k?void(s=!1):(b.disableLogs||console.info("Seems recording has been restarted."),void this.record())},this.clearRecordedData=function(){this.pause(),i.length=j.length=0,l=0};var t=!1;g.onaudioprocess=f,g.connect(n.destination)}function CanvasRecorder(a,b){function c(){var b=document.createElement("canvas"),c=b.getContext("2d");return b.width=a.width,b.height=a.height,c.drawImage(a,0,0),b}function d(){if(l)return m=(new Date).getTime(),setTimeout(d,500);if("canvas"===a.nodeName.toLowerCase()){var e=(new Date).getTime()-m;return m=(new Date).getTime(),n.frames.push({image:c(),duration:e}),void(k&&setTimeout(d,b.frameInterval))}html2canvas(a,{grabMouse:"undefined"==typeof b.showMousePointer||b.showMousePointer,onrendered:function(a){var c=(new Date).getTime()-m;return c?(m=(new Date).getTime(),n.frames.push({image:a.toDataURL("image/webp",1),duration:c}),void(k&&setTimeout(d,b.frameInterval))):setTimeout(d,b.frameInterval)}})}if("undefined"==typeof html2canvas&&"canvas"!==a.nodeName.toLowerCase())throw"Please link: https://cdn.webrtc-experiment.com/screenshot.js";b=b||{},b.frameInterval||(b.frameInterval=10);var e=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(a){a in document.createElement("canvas")&&(e=!0)});var f=!(!window.webkitRTCPeerConnection&&!window.webkitGetUserMedia||!window.chrome),g=50,h=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);f&&h&&h[2]&&(g=parseInt(h[2],10)),f&&52>g&&(e=!1);var i,j;if(e)if(b.disableLogs||console.debug("Your browser supports both MediRecorder API and canvas.captureStream!"),a instanceof HTMLCanvasElement)i=a;else{if(!(a instanceof CanvasRenderingContext2D))throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";i=a.canvas}else navigator.mozGetUserMedia&&(b.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));var k;this.record=function(){if(k=!0,e){var a;"captureStream"in i?a=i.captureStream(25):"mozCaptureStream"in i?a=i.mozCaptureStream(25):"webkitCaptureStream"in i&&(a=i.webkitCaptureStream(25));try{var c=new MediaStream;c.addTrack(a.getVideoTracks()[0]),a=c}catch(f){}if(!a)throw"captureStream API are NOT available.";j=new MediaStreamRecorder(a,{mimeType:"video/webm"}),j.record()}else n.frames=[],m=(new Date).getTime(),d();b.initCallback&&b.initCallback()},this.getWebPImages=function(c){if("canvas"!==a.nodeName.toLowerCase())return void c();var d=n.frames.length;n.frames.forEach(function(a,c){var e=d-c;b.disableLogs||console.debug(e+"/"+d+" frames remaining"),b.onEncodingCallback&&b.onEncodingCallback(e,d);var f=a.image.toDataURL("image/webp",1);n.frames[c].image=f}),b.disableLogs||console.debug("Generating WebM"),c()},this.stop=function(a){k=!1;var c=this;return e&&j?void j.stop(a):void this.getWebPImages(function(){n.compile(function(d){b.disableLogs||console.debug("Recording finished!"),c.blob=d,c.blob.forEach&&(c.blob=new Blob([],{type:"video/webm"})),a&&a(c.blob),n.frames=[]})})};var l=!1;this.pause=function(){l=!0},this.resume=function(){l=!1,k||this.record()},this.clearRecordedData=function(){this.pause(),n.frames=[]};var m=(new Date).getTime(),n=new Whammy.Video(100)}function WhammyRecorder(a,b){function c(a){a="undefined"!=typeof a?a:10;var b=(new Date).getTime()-i;return b?g?(i=(new Date).getTime(),setTimeout(c,100)):(i=(new Date).getTime(),h.paused&&h.play(),l.drawImage(h,0,0,k.width,k.height),j.frames.push({duration:b,image:k.toDataURL("image/webp")}),void(f||setTimeout(c,a,a))):setTimeout(c,a,a)}function d(a){var b=-1,c=a.length,d=function(){return b++,b===c?void a.callback():void a.functionToLoop(d,b)};d()}function e(a,b,c,e,f){var g=document.createElement("canvas");g.width=k.width,g.height=k.height;var h=g.getContext("2d"),i=[],j=-1===b,l=b&&b>0&&b<=a.length?b:a.length,m={r:0,g:0,b:0},n=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),o=c&&c>=0&&1>=c?c:0,p=e&&e>=0&&1>=e?e:0,q=!1;d({length:l,functionToLoop:function(b,c){var d,e,f,g=function(){!q&&f*p>=f-d||(j&&(q=!0),i.push(a[c])),b()};if(q)g();else{var l=new Image;l.onload=function(){h.drawImage(l,0,0,k.width,k.height);var a=h.getImageData(0,0,k.width,k.height);d=0,e=a.data.length,f=a.data.length/4;for(var b=0;e>b;b+=4){var c={r:a.data[b],g:a.data[b+1],b:a.data[b+2]},i=Math.sqrt(Math.pow(c.r-m.r,2)+Math.pow(c.g-m.g,2)+Math.pow(c.b-m.b,2));n*o>=i&&d++}g()},l.src=a[c].image}},callback:function(){i=i.concat(a.slice(l)),i.length<=0&&i.push(a[a.length-1]),f(i)}})}b=b||{},b.frameInterval||(b.frameInterval=10),b.disableLogs||console.log("Using frames-interval:",b.frameInterval),this.record=function(){b.width||(b.width=320),b.height||(b.height=240),b.video||(b.video={width:b.width,height:b.height}),b.canvas||(b.canvas={width:b.width,height:b.height}),k.width=b.canvas.width||320,k.height=b.canvas.height||240,l=k.getContext("2d"),b.video&&b.video instanceof HTMLVideoElement?(h=b.video.cloneNode(),b.initCallback&&b.initCallback()):(h=document.createElement("video"),"undefined"!=typeof h.srcObject?h.srcObject=a:h.src=URL.createObjectURL(a),h.onloadedmetadata=function(){b.initCallback&&b.initCallback()},h.width=b.video.width,h.height=b.video.height),h.muted=!0,h.play(),i=(new Date).getTime(),j=new Whammy.Video,b.disableLogs||(console.log("canvas resolutions",k.width,"*",k.height),console.log("video width/height",h.width||k.width,"*",h.height||k.height)),c(b.frameInterval)};var f=!1;this.stop=function(a){f=!0;var c=this;setTimeout(function(){e(j.frames,-1,null,null,function(d){j.frames=d,b.advertisement&&b.advertisement.length&&(j.frames=b.advertisement.concat(j.frames)),j.compile(function(b){c.blob=b,c.blob.forEach&&(c.blob=new Blob([],{type:"video/webm"})),a&&a(c.blob)})})},10)};var g=!1;this.pause=function(){g=!0},this.resume=function(){g=!1,f&&this.record()},this.clearRecordedData=function(){this.pause(),j.frames=[]};var h,i,j,k=document.createElement("canvas"),l=k.getContext("2d")}function GifRecorder(a,b){if("undefined"==typeof GIFEncoder)throw"Please link: https://cdn.webrtc-experiment.com/gif-recorder.js";b=b||{};var c=a instanceof CanvasRenderingContext2D||a instanceof HTMLCanvasElement;this.record=function(){function a(h){return d?setTimeout(function(){a(h)},100):(l=requestAnimationFrame(a),void 0===typeof j&&(j=h),void(90>h-j||(!c&&g.paused&&g.play(),c||f.drawImage(g,0,0,e.width,e.height),b.onGifPreview&&b.onGifPreview(e.toDataURL("image/png")),k.addFrame(f),j=h)))}c||(b.width||(b.width=g.offsetWidth||320),this.height||(b.height=g.offsetHeight||240),b.video||(b.video={width:b.width,height:b.height}),b.canvas||(b.canvas={width:b.width,height:b.height}),e.width=b.canvas.width||320,e.height=b.canvas.height||240,g.width=b.video.width||320,g.height=b.video.height||240),k=new GIFEncoder,k.setRepeat(0),k.setDelay(b.frameRate||200),k.setQuality(b.quality||10),k.start(),h=Date.now();l=requestAnimationFrame(a),b.initCallback&&b.initCallback()},this.stop=function(){l&&cancelAnimationFrame(l),i=Date.now(),this.blob=new Blob([new Uint8Array(k.stream().bin)],{type:"image/gif"}),k.stream().bin=[]};var d=!1;this.pause=function(){d=!0},this.resume=function(){d=!1},this.clearRecordedData=function(){k&&(this.pause(),k.stream().bin=[])};var e=document.createElement("canvas"),f=e.getContext("2d");if(c&&(a instanceof CanvasRenderingContext2D?(f=a,e=f.canvas):a instanceof HTMLCanvasElement&&(f=a.getContext("2d"),e=a)),!c){var g=document.createElement("video");g.muted=!0,g.autoplay=!0,"undefined"!=typeof g.srcObject?g.srcObject=a:g.src=URL.createObjectURL(a),g.play()}var h,i,j,k,l=null}RecordRTC.getFromDisk=function(a,b){if(!b)throw"callback is mandatory.";console.log("Getting recorded "+("all"===a?"blobs":a+" blob ")+" from disk!"),DiskStorage.Fetch(function(c,d){"all"!==a&&d===a+"Blob"&&b&&b(c),"all"===a&&b&&b(c,d.replace("Blob",""))})},RecordRTC.writeToDisk=function(a){console.log("Writing recorded blob(s) to disk!"),a=a||{},a.audio&&a.video&&a.gif?a.audio.getDataURL(function(b){a.video.getDataURL(function(c){a.gif.getDataURL(function(a){DiskStorage.Store({audioBlob:b,videoBlob:c,gifBlob:a})})})}):a.audio&&a.video?a.audio.getDataURL(function(b){a.video.getDataURL(function(a){DiskStorage.Store({audioBlob:b,videoBlob:a})})}):a.audio&&a.gif?a.audio.getDataURL(function(b){a.gif.getDataURL(function(a){DiskStorage.Store({audioBlob:b,gifBlob:a})})}):a.video&&a.gif?a.video.getDataURL(function(b){a.gif.getDataURL(function(a){DiskStorage.Store({videoBlob:b,gifBlob:a})})}):a.audio?a.audio.getDataURL(function(a){DiskStorage.Store({audioBlob:a})}):a.video?a.video.getDataURL(function(a){DiskStorage.Store({videoBlob:a})}):a.gif&&a.gif.getDataURL(function(a){DiskStorage.Store({gifBlob:a})})},"undefined"!=typeof module&&(module.exports=RecordRTC),"function"==typeof define&&define.amd&&define("RecordRTC",[],function(){return RecordRTC}),MRecordRTC.getFromDisk=RecordRTC.getFromDisk,MRecordRTC.writeToDisk=RecordRTC.writeToDisk,"undefined"!=typeof RecordRTC&&(RecordRTC.MRecordRTC=MRecordRTC);var browserFakeUserAgent="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";!function(a){a&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:browserFakeUserAgent,getUserMedia:function(){}},global.console||(global.console={}),"undefined"==typeof global.console.debug&&(global.console.debug=global.console.info=global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(a.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var a={getContext:function(){return a},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return a},a.HTMLVideoElement=function(){}),"undefined"==typeof location&&(a.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(a.screen={width:0,height:0}),"undefined"==typeof URL&&(a.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),a.window=global)}("undefined"!=typeof global?global:null);var requestAnimationFrame=window.requestAnimationFrame;"undefined"==typeof requestAnimationFrame&&("undefined"!=typeof webkitRequestAnimationFrame&&(requestAnimationFrame=webkitRequestAnimationFrame),"undefined"!=typeof mozRequestAnimationFrame&&(requestAnimationFrame=mozRequestAnimationFrame));var cancelAnimationFrame=window.cancelAnimationFrame;"undefined"==typeof cancelAnimationFrame&&("undefined"!=typeof webkitCancelAnimationFrame&&(cancelAnimationFrame=webkitCancelAnimationFrame),"undefined"!=typeof mozCancelAnimationFrame&&(cancelAnimationFrame=mozCancelAnimationFrame));var AudioContext=window.AudioContext;"undefined"==typeof AudioContext&&("undefined"!=typeof webkitAudioContext&&(AudioContext=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(AudioContext=mozAudioContext));var URL=window.URL;"undefined"==typeof URL&&"undefined"!=typeof webkitURL&&(URL=webkitURL),"undefined"!=typeof navigator&&"undefined"==typeof navigator.getUserMedia&&("undefined"!=typeof navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),"undefined"!=typeof navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var isEdge=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob),isOpera=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),isChrome=!isOpera&&!isEdge&&!!navigator.webkitGetUserMedia,MediaStream=window.MediaStream;"undefined"==typeof MediaStream&&"undefined"!=typeof webkitMediaStream&&(MediaStream=webkitMediaStream),"undefined"!=typeof MediaStream&&("getVideoTracks"in MediaStream.prototype||(MediaStream.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var a=[];return this.getTracks.forEach(function(b){-1!==b.kind.toString().indexOf("video")&&a.push(b)}),a},MediaStream.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var a=[];return this.getTracks.forEach(function(b){-1!==b.kind.toString().indexOf("audio")&&a.push(b)}),a}),"stop"in MediaStream.prototype||(MediaStream.prototype.stop=function(){this.getAudioTracks().forEach(function(a){a.stop&&a.stop()}),this.getVideoTracks().forEach(function(a){a.stop&&a.stop()})}));var Storage={};"undefined"!=typeof AudioContext?Storage.AudioContext=AudioContext:"undefined"!=typeof webkitAudioContext&&(Storage.AudioContext=webkitAudioContext),"undefined"!=typeof RecordRTC&&(RecordRTC.Storage=Storage),"undefined"!=typeof RecordRTC&&(RecordRTC.MediaStreamRecorder=MediaStreamRecorder),"undefined"!=typeof RecordRTC&&(RecordRTC.StereoAudioRecorder=StereoAudioRecorder),"undefined"!=typeof RecordRTC&&(RecordRTC.CanvasRecorder=CanvasRecorder),"undefined"!=typeof RecordRTC&&(RecordRTC.WhammyRecorder=WhammyRecorder);var Whammy=function(){function a(a){this.frames=[],this.duration=a||1,this.quality=.8}function b(a){var b=URL.createObjectURL(new Blob([a.toString(),"this.onmessage =  function (e) {"+a.name+"(e.data);}"],{type:"application/javascript"})),c=new Worker(b);return URL.revokeObjectURL(b),c}function c(a){function b(a){var b=d(a);if(!b)return[];for(var e=3e4,f=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:m(b.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:b.width,id:176},{data:b.height,id:186}]}]}]}]}],g=0,i=0;g<a.length;){var j=[],k=0;do j.push(a[g]),k+=a[g].duration,g++;while(g<a.length&&e>k);var l=0,n={id:524531317,data:c(i,l,j)};f[1].data.push(n),i+=k}return h(f)}function c(a,b,c){return[{data:a,id:231}].concat(c.map(function(a){var c=i({discardable:0,frame:a.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(b)});return b+=a.duration,{data:c,id:163}}))}function d(a){if(!a[0])return void postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});for(var b=a[0].width,c=a[0].height,d=a[0].duration,e=1;e<a.length;e++)d+=a[e].duration;return{duration:d,width:b,height:c}}function e(a){for(var b=[];a>0;)b.push(255&a),a>>=8;return new Uint8Array(b.reverse())}function f(a){return new Uint8Array(a.split("").map(function(a){return a.charCodeAt(0)}))}function g(a){var b=[],c=a.length%8?new Array(9-a.length%8).join("0"):"";a=c+a;for(var d=0;d<a.length;d+=8)b.push(parseInt(a.substr(d,8),2));return new Uint8Array(b)}function h(a){for(var b=[],c=0;c<a.length;c++){var d=a[c].data;"object"==typeof d&&(d=h(d)),"number"==typeof d&&(d=g(d.toString(2))),"string"==typeof d&&(d=f(d));var i=d.size||d.byteLength||d.length,j=Math.ceil(Math.ceil(Math.log(i)/Math.log(2))/8),k=i.toString(2),l=new Array(7*j+7+1-k.length).join("0")+k,m=new Array(j).join("0")+"1"+l;
b.push(e(a[c].id)),b.push(g(m)),b.push(d)}return new Blob(b,{type:"video/webm"})}function i(a){var b=0;if(a.keyframe&&(b|=128),a.invisible&&(b|=8),a.lacing&&(b|=a.lacing<<1),a.discardable&&(b|=1),a.trackNum>127)throw"TrackNumber > 127 not supported";var c=[128|a.trackNum,a.timecode>>8,255&a.timecode,b].map(function(a){return String.fromCharCode(a)}).join("")+a.frame;return c}function j(a){for(var b=a.RIFF[0].WEBP[0],c=b.indexOf("*"),d=0,e=[];4>d;d++)e[d]=b.charCodeAt(c+3+d);var f,g,h;return h=e[1]<<8|e[0],f=16383&h,h=e[3]<<8|e[2],g=16383&h,{width:f,height:g,data:b,riff:a}}function k(a,b){return parseInt(a.substr(b+4,4).split("").map(function(a){var b=a.charCodeAt(0).toString(2);return new Array(8-b.length+1).join("0")+b}).join(""),2)}function l(a){for(var b=0,c={};b<a.length;){var d=a.substr(b,4),e=k(a,b),f=a.substr(b+4+4,e);b+=8+e,c[d]=c[d]||[],c[d].push("RIFF"===d||"LIST"===d?l(f):f)}return c}function m(a){return[].slice.call(new Uint8Array(new Float64Array([a]).buffer),0).map(function(a){return String.fromCharCode(a)}).reverse().join("")}var n=new b(a.map(function(a){var b=j(l(atob(a.image.slice(23))));return b.duration=a.duration,b}));postMessage(n)}return a.prototype.add=function(a,b){if("canvas"in a&&(a=a.canvas),"toDataURL"in a&&(a=a.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(a))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:a,duration:b||this.duration})},a.prototype.compile=function(a){var d=b(c);d.onmessage=function(b){return b.data.error?void console.error(b.data.error):void a(b.data)},d.postMessage(this.frames)},{Video:a}}();"undefined"!=typeof RecordRTC&&(RecordRTC.Whammy=Whammy);var DiskStorage={init:function(){function a(a){a.createObjectStore(c.dataStoreName)}function b(){function a(a){b.objectStore(c.dataStoreName).get(a).onsuccess=function(b){c.callback&&c.callback(b.target.result,a)}}var b=d.transaction([c.dataStoreName],"readwrite");c.videoBlob&&b.objectStore(c.dataStoreName).put(c.videoBlob,"videoBlob"),c.gifBlob&&b.objectStore(c.dataStoreName).put(c.gifBlob,"gifBlob"),c.audioBlob&&b.objectStore(c.dataStoreName).put(c.audioBlob,"audioBlob"),a("audioBlob"),a("videoBlob"),a("gifBlob")}var c=this;if("undefined"==typeof indexedDB||"undefined"==typeof indexedDB.open)return void console.error("IndexedDB API are not available in this browser.");var d,e=1,f=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),g=indexedDB.open(f,e);g.onerror=c.onError,g.onsuccess=function(){if(d=g.result,d.onerror=c.onError,d.setVersion)if(d.version!==e){var f=d.setVersion(e);f.onsuccess=function(){a(d),b()}}else b();else b()},g.onupgradeneeded=function(b){a(b.target.result)}},Fetch:function(a){return this.callback=a,this.init(),this},Store:function(a){return this.audioBlob=a.audioBlob,this.videoBlob=a.videoBlob,this.gifBlob=a.gifBlob,this.init(),this},onError:function(a){console.error(JSON.stringify(a,null,"	"))},dataStoreName:"recordRTC",dbName:null};"undefined"!=typeof RecordRTC&&(RecordRTC.DiskStorage=DiskStorage),"undefined"!=typeof RecordRTC&&(RecordRTC.GifRecorder=GifRecorder);